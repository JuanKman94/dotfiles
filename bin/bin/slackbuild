#!/bin/bash
# Install package using SlackBuilds (R) method
#
# Usage: slackbuild <sb pkg>[.tar.gz]

# exit on error
set -e

ARCHIVE=$1
NAME="${ARCHIVE%.tar.gz}" # take an archive from slackbuilds.com
NAME="${NAME%/}"          # or a slackbuild package directory

if [ ! -f "$ARCHIVE" -a ! -d "$NAME" ]; then
    echo "Package not found"
    exit 1
fi

[ -f "$ARCHIVE" ] && tar xf "$ARCHIVE"

cd $NAME
NAME="$(basename "$NAME")"

source $NAME.info

# check if DOWNLOAD_x86_64 is configured
if [ "$DOWNLOAD" == "UNSUPPORTED" -a -n "$DOWNLOAD_x86_64" ]; then
    DOWNLOAD="$DOWNLOAD_x86_64"
fi

if [ -z "$DOWNLOAD" ]; then
    echo "No DOWNLOAD source"
    exit 1
fi

wget --continue $DOWNLOAD
if [ $? -ne 0 ]; then
    echo "Something went wrong with wget"
    exit 1
fi

chmod +x "${NAME}.SlackBuild"
sudo "./${NAME}.SlackBuild"
sudo /sbin/upgradepkg --install-new /tmp/${PRGNAM}-*.tgz
